<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Inserisci il link</title>
    <script type="text/javascript" src="/wp/wp-includes/js/tinymce/tiny_mce_popup.js"></script>
    
    <script>

        /// dati iniettati dal controller
        var storedLinks = {{stored_links}};
        var subjects = {{subjects}};
        var programs = {{programs}};

        /** 
         * Per gestire i campi
         */
         function FieldsManager() { 
            
            this.subject = document.getElementById('subject');
            this.program = document.getElementById('program');
            
            this.submit   = document.getElementById('submit');
    
            
            this.submit.addEventListener('click', function(e) {

                var subject = this.subject.value;
                var program = this.program.value;
                
                if (subject  == '') {
                    alert("Selezionare un subject"); 
                    return;
                }

                if (program  == '') {
                    alert("Selezionare un programma"); 
                    return;
                }
                
                this.shortcode = `[affiliate_program_link link="${link}" author_tracking_id="${author_tracking_id} "subject="${subject}" program="${program}" ]`;
                
                tinyMCE.activeEditor.execCommand( 'mceInsertContent', 0, this.shortcode );
                
                tinyMCEPopup.close();

            }.bind(this));
        }


        window.addEventListener('DOMContentLoaded', function() {
            
            new FieldsManager();

        }.bind(this));

    </script>

    <style>
        body { padding: 10px; background-color: #eee;}
        
        input, select { 
            width: 90%; 
            padding: 4px ;
            font-size:13px;
            border-radius: 5px;
            margin-left: 5%;
        }

        legend {margin: 10px 0 2px 5%; font-size:13px; }

        #submit {
            width: 300px;
            background-color: lightblue;
            margin:20px auto;         
            display: block;   
        }
    </style>
    
    
</head>
<body onload="tinyMCEPopup.executeOnLoad('init();')">
    
    <legend>Seleziona il subject</legend>
                        
    <select name="subject" id="subject">
        <option value="">-- scegli --</option>        
    </select>
    <script>
        var subject_select = document.getElementById('subject');
        subjects.forEach( function(item) { 
            subject_select.insertAdjacentHTML('beforeend', `<option value="${item}">${item}</option>`); 
        });      
    </script>

    <legend>Seleziona il programma</legend>
                            
    <select name="program" id="program">
        <option value="">-- scegli --</option>        
    </select>
    <script>
        var program_select = document.getElementById('program');
        programs.forEach( function(item) { 
            program_select.insertAdjacentHTML('beforeend', `<option value="${item}">${item}</option>`); 
        });      
    </script>

    <input type="button" id="submit" value="Inserisci" />
    
</body>
</html>